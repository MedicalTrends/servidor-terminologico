<ui:composition 
    xmlns="http://www.w3.org/1999/xhtml"
    xmlns:f="http://java.sun.com/jsf/core"
    xmlns:h="http://java.sun.com/jsf/html"
    xmlns:ui="http://java.sun.com/jsf/facelets"
    xmlns:p="http://primefaces.org/ui"
    xmlns:pu="http://primefaces.org/ultima">


    <h:form id="browserForm">
        <div class="layout-menu #{guestPreferences.menuClass}">
            <div class="nano">
                <div class="nano-content menu-scroll-content">
                    <ui:fragment rendered="#{guestPreferences.profileMode == 'inline' and guestPreferences.menuLayout != 'menu-layout-static menu-layout-horizontal'}">

                    </ui:fragment>

                    <pu:menu widgetVar="me" model="#{browserBean.menu}" rendered="#{true}"/>

                    <pu:menu widgetVar="me" model="#{browserSCTBean.menu}" rendered="#{false}"/>

                    <p:outputPanel rendered="true">
                        <div class="ui-fluid ui-g">
                            <div class="ui-g-4 ui-md-4 ui-lg-4">
                                <p:outputLabel value="Buscar en:"/>
                            </div>
                            <div class="ui-g-8 ui-md-8 ui-lg-8">
                                <p:selectOneMenu value="#{browserBean.snomedCT}" styleClass="searchMenu">
                                    <f:selectItem itemLabel="Semantikos" itemValue="false"/>
                                    <f:selectItem itemLabel="Snomed-CT" itemValue="true"/>
                                    <p:ajax event="itemSelect" process="@this"
                                           update="@(.search),@(.conceptPanel)"  />
                                </p:selectOneMenu>
                            </div>
                        </div>
                    </p:outputPanel>

                    <p:outputPanel rendered="true">
                        <div class="ui-fluid ui-g">
                            <div class="ui-g-12 ui-md-12 ui-lg-12">

                                <p:outputPanel style="width: 100%" styleClass="search">

                                    <p:inputText id="search_input" value="#{browserBean.browserQuery.query}" placeholder="Buscar en Semantikos..."
                                                 style="width: 100%" styleClass="search_input"
                                                 onkeyup="return (this.value.length >= 3 || this.value.length == 0)" rendered="#{ not browserBean.snomedCT}">
                                        <p:ajax event="keyup" update="@(.conceptPanel),@(.search2)" process="@this" oncomplete="mark();"
                                                listener="#{browserBean.setFilterChanged(true)}"/>
                                    </p:inputText>

                                    <p:inputText id="search_input2" value="#{browserSCTBean.snomedQuery.query}" placeholder="Buscar en Snomed-CT..."
                                                 style="width: 100%" styleClass="search_input"
                                                 onkeyup="return (this.value.length >= 3 || this.value.length == 0)" rendered="#{browserBean.snomedCT}">
                                        <p:ajax event="keyup" update="@(.conceptPanel),@(.search2)" process="@this" oncomplete="mark();"
                                                listener="#{browserSCTBean.setFilterChanged(true)}"/>
                                    </p:inputText>

                                    <i class="fa fa-search fa-lg" />

                                </p:outputPanel>

                                <p:outputPanel styleClass="filterStatus" style="width: 100%">
                                    <p:repeat value="#{browserBean.browserQuery.categories}" var="category">
                                        <div class="ui-g-12 ui-md-12 ui-lg-12" style="padding-bottom: 0px">
                                            <span style="display: inherit; padding: 4px" class="ui-state-active ui-corner-all ui-helper-hidden">
                                                <p:commandLink actionListener="#{browserBean.browserQuery.categories.remove(category)}"
                                                               update="@(.conceptTable),@(.filterStatus)" style="float: right">
                                                    <i class="ui-icon ui-icon-close" />
                                                </p:commandLink>
                                                <span class="ui-autocomplete-token-label" style="font-size: small;">#{category.name}</span>
                                            </span>
                                        </div>
                                    </p:repeat>
                                </p:outputPanel>

                            </div>
                        </div>
                    </p:outputPanel>

                    <div class="ui-fluid ui-g">
                        <div class="ui-g-12 ui-md-12 ui-lg-12">

                            <p:outputPanel styleClass="search2">
                                <p:outputLabel id="summary" style="font-size: small; color: #212121"
                                               value="Página #{browserBean.page} de #{browserBean.results} conceptos"/>
                                <p:remoteCommand name="onload" update="summary"
                                                 autoRun="true" />
                            </p:outputPanel>

                        </div>
                    </div>

                    <p:outputPanel id="conceptPanel" styleClass="conceptPanel">

                    <p:dataTable id="conceptTable" value="#{browserBean.concepts}" var="conceptSMTK" styleClass="conceptTable"
                                 widgetVar="conceptTable"
                                 rendered="#{not empty browserBean.concepts and not browserBean.snomedCT}"
                                 multiViewState="true"
                                 rows="15"
                                 paginator="true" lazy="true" dynamic="true"
                                 paginatorTemplate="{FirstPageLink} {PreviousPageLink} {NextPageLink} {LastPageLink}"
                                 emptyMessage="No se han encontrado conceptos con los criterios utilizados">

                        <p:ajax event="page" listener="#{browserBean.updatePage}" oncomplete="scrollTop(); loader(); listen();" update="@(.search),@(.search2)" />

                        <p:column headerText="Termino Preferido" style="padding: 0px" styleClass="#{concept == concept.selectedConcept ? 'concept-selected':''}">
                            <div class="ui-g dashboard">
                                <div class="ui-g-12" style="padding: 0px">
                                    <div class="card overview" style="min-height: 0px; border-bottom: 1px solid #cfcfcf;">
                                        <div class="overview-content clearfix" style="padding: 10px">
                                            <span class="overview-title">
                                                <p:commandLink value="#{conceptSMTK.descriptionFavorite.term}" rendered="true"
                                                               actionListener="#{concept.setConceptID(conceptSMTK.conceptID)}"
                                                               update="@(.conceptForm)" oncomplete="scrolltop();"
                                                        styleClass="context" style="font-size: medium">
                                                </p:commandLink>
                                                <p:link value="#{conceptSMTK.descriptionFavorite.term}" rendered="false"
                                                               oncomplete="scrolltop();" outcome="/views/concept"
                                                               styleClass="context" style="font-size: medium">
                                                    <f:param name="conceptID" value="#{conceptSMTK.conceptID}" />
                                                </p:link>
                                            </span>
                                            <span class="overview-detail">
                                                <h:outputText value="#{conceptSMTK.conceptID}" style="font-size: small; color: #006621" />
                                                <br/>
                                                <h:outputText value="#{conceptSMTK.category.name}" style="font-size: small; color:#545454;" />

                                                <p:separator style="border-top: 0px solid rgb(219, 219, 219)" rendered="#{ not empty conceptSMTK.tags }"/>

                                                 <p:outputPanel rendered="#{ not empty conceptSMTK.tags}">
                                                    <i class="fa fa-tags" style="font-size: small"/>
                                                    <p:repeat
                                                            offset="0"
                                                            size="#{conceptSMTK.tags.size()}"
                                                            step="1"
                                                            varStatus="var"
                                                            value="#{conceptSMTK.tags}"
                                                            var="tag">

                                                        <h:outputText value=" #{tag}" style="font-size: small; background-color: ##{tag.colorBackground}; color:##{tag.colorLetter}; border: 1px" styleClass="BorderAll SoftGrayBack LeadenGreen"  />
                                                        <h:outputText value=", " style="font-size: small; color: #545454"/>

                                                    </p:repeat>
                                                </p:outputPanel>

                                            </span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </p:column>

                    </p:dataTable>

                    <p:dataTable id="conceptTableSCT" value="#{browserSCTBean.concepts}" var="concept" styleClass="conceptTableSCT"
                                 widgetVar="conceptTable"
                                 rendered="#{not empty browserSCTBean.concepts and browserBean.snomedCT}"
                                 multiViewState="true"
                                 rows="15"
                                 paginator="true" lazy="true" dynamic="true"
                                 paginatorTemplate=" {FirstPageLink} {PreviousPageLink} {NextPageLink} {LastPageLink}"
                                 emptyMessage="No se han encontrado conceptos con los criterios utilizados">

                        <p:ajax event="page" listener="#{browserSCTBean.updatePage}" oncomplete="scrollTop(); loader(); listen();" update="@(.search),@(.search2)" />

                        <p:column headerText="Termino Preferido" style="padding: 0px">
                            <div class="ui-g dashboard">
                                <div class="ui-g-12" style="padding: 0px">
                                    <div class="card overview" style="min-height: 0px; border-bottom: 1px solid #cfcfcf;">
                                        <div class="overview-content clearfix" style="padding: 10px">
                                                <span class="overview-title">
                                                    <p:commandLink value="#{concept.getDescriptionFSN().term}" rendered="true"
                                                                   actionListener="#{conceptSCT.setConceptID(concept.id)}"
                                                                   update="@(.conceptForm)"
                                                                   styleClass="context" style="font-size: medium">
                                                    </p:commandLink>
                                                    <p:link value="#{concept.getDescriptionFSN().term}" rendered="false"
                                                            oncomplete="scrolltop();" outcome="/views/concept-snomed"
                                                            styleClass="context" style="font-size: medium">
                                                        <f:param name="conceptID" value="#{concept.id}" />
                                                    </p:link>
                                                </span>
                                                <span class="overview-detail">
                                                    <h:outputText value="#{concept.id}" style="font-size: small; color: #006621" />
                                                    <br/>

                                                </span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </p:column>

                    </p:dataTable>

                    <p:dataTable id="conceptTableExcel" widgetVar="conceptTableExcel" value="#{browserBean.concepts}"
                                 var="conceptSMTK" styleClass="conceptTable"
                                 style="display: none"
                                 rows="15" rendered="false"
                                 paginator="true" lazy="true" dynamic="true"
                                 reflow="true"
                                 paginatorTemplate=" {CurrentPageReport}  {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {Exporters}"
                                 emptyMessage="No se han encontrado conceptos con los criterios utilizados">

                        <f:facet name="{Exporters}">
                            <p:commandButton ajax="false" value="Exportar a Excel" process="@this" update="@this"
                                             icon="fa fa-file-excel-o">
                                <p:dataExporter type="xls" target="conceptTable"
                                                fileName="conceptos"/>
                            </p:commandButton>
                        </f:facet>

                        <p:column headerText="Concept ID">
                            <h:outputText value="#{conceptSMTK.conceptID}"/>
                        </p:column>

                        <p:column headerText="Termino Preferido">
                            <h:outputText value="#{conceptSMTK.descriptionFavorite.term}"/>
                        </p:column>

                        <p:column headerText="Categoría">
                            <h:outputText value="#{conceptSMTK.category.name}"/>
                        </p:column>

                        <p:column headerText="Etiquetas" styleClass="tags" exportable="false">

                            <p:repeat
                                    offset="0"
                                    size="#{conceptSMTK.tags.size()}"
                                    step="1"
                                    varStatus="var"
                                    value="#{conceptSMTK.tags}"
                                    var="tag">

                                <h:outputText value="#{tag}" style="background-color: ##{tag.colorBackground}; color:##{tag.colorLetter}; border: 1px" styleClass="BorderAll SoftGrayBack LeadenGreen"  />
                                <h:outputText value=", " rendered="#{conceptSMTK.tags.size() > 1}" />

                            </p:repeat>

                        </p:column>

                    </p:dataTable>

                    </p:outputPanel>

                </div>
            </div>
        </div>
    </h:form>

    <script type="text/javascript">

        function scrolltop() {
            setTimeout(
                    function() {
                        window.scroll(0, 0);
                    }, 0);
        }

    </script>

</ui:composition>