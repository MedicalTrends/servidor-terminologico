<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:p="http://primefaces.org/ui">

<h:head>
    <f:facet name="first">
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0"/>
        <meta name="apple-mobile-web-app-capable" content="yes" />
    </f:facet>
    <title>Semantikos Minsal</title>
    <h:outputScript name="js/ripple.js" library="ultima-layout" />
    <h:outputScript name="js/layout.js" library="ultima-layout" />
</h:head>

<h:body styleClass="login-body" style="padding: 15px">

    <div class="card card-w-title login-panel ui-fluid" style="width: 100%; max-width: 600px">

        <h:form id="loginform" style="margin-bottom: 0px" onkeypress="return event.keyCode != 13">

            <p:messages id="login-form-messages" showDetail="true" autoUpdate="true" closable="false" rendered="false" />
            <p:growl id="login-form-messages-2" showDetail="true" showSummary="true"  />

            <div class="ui-g">
                <div class="ui-g-12">
                    <p:graphicImage name="images/logo-indigo.png" style="width:230px" library="semantikos" />
                </div>

                <div class="ui-g-12" style="padding: 0px">
                    <p:outputPanel styleClass="headerPanel">
                        <p:outputPanel rendered="#{ not accountRecovery.maxAttemptsReached() and not accountRecovery.passwordChanged }" >
                            <div style="text-align: center;font-size: 22px;color: #E91E63; padding-bottom: 10px">Recuperación de cuenta</div>
                            <p:outputPanel>
                                <div style="text-align: center;color: #607D8B;">Por favor, complete el siguiente formulario</div>
                            </p:outputPanel>
                            <br/>
                        </p:outputPanel>
                        <p:outputPanel rendered="#{ accountRecovery.maxAttemptsReached() and not accountRecovery.passwordChanged }" >
                            <div style="text-align: center;font-size: 24px;color:dimgray;">Recuperación de cuenta</div>
                            <p:outputPanel>
                                <div style="text-align: center;color:dimgray;">Por razones de seguridad esta cuenta ha sido bloqueada. Por favor, contacte al administrador</div>
                            </p:outputPanel>
                        </p:outputPanel>
                        <p:outputPanel rendered="#{ accountRecovery.passwordChanged }" >
                            <div style="text-align: center;font-size: 24px;color:dimgray;">Recuperación de cuenta</div>
                            <p:outputPanel>
                                <div style="text-align: center;color:dimgray;">Su contraseña ha sido actualizada!! Para ingresar al sistema diríjase al login</div>
                            </p:outputPanel>
                        </p:outputPanel>
                    </p:outputPanel>
                </div>

                <div class="ui-g-12" style="padding: 0px">
                    <p:growl id="growl" showDetail="true" showSummary="true"/>

                    <p:fieldset legend="Identificación de usuario" rendered="#{ not accountRecovery.maxAttemptsReached() and not accountRecovery.passwordChanged }">

                        <div class="ui-fluid">

                            <div class="ui-g">

                                <div class="ui-g-12 ui-md-12 ui-lg-12">
                                    <h:panelGroup styleClass="md-inputfield">
                                        <p:inputText value="#{accountRecovery.email}" styleClass="#{accountRecovery.emailError}" autocomplete="off" />
                                        <label>Email</label>
                                    </h:panelGroup>
                                </div>

                                <div class="ui-g-12 ui-md-12 ui-lg-12">
                                    <p:commandButton actionListener="#{accountRecovery.findUser}"
                                                     style="width: auto; float: right; margin-bottom: 0px"
                                                     value="Enviar" process="loginform"
                                                     update="growl, loginform, @(.headerPanel)">
                                    </p:commandButton>
                                </div>

                            </div>

                        </div>

                    </p:fieldset>

                    <p:spacer rendered="#{accountRecovery.user != null and not accountRecovery.maxAttemptsReached() and not accountRecovery.passwordChanged }" />

                    <p:fieldset legend="Preguntas de seguridad" rendered="#{accountRecovery.user != null and not accountRecovery.maxAttemptsReached() and not accountRecovery.passwordChanged }"
                                styleClass="answers">

                        <div class="ui-fluid">

                            <div class="ui-g">

                                <p:repeat value="#{accountRecovery.user.answers}" var="answer">

                                    <div class="ui-g-12 ui-md-12 ui-lg-12">
                                        <h:panelGroup styleClass="md-inputfield">
                                            <p:inputText value="#{answer.answer}" autocomplete="off" >
                                                <p:ajax process="@this" update="@this" />
                                            </p:inputText>
                                            <label style="font-size: small">#{answer.question.question}</label>
                                        </h:panelGroup>
                                    </div>

                                </p:repeat>

                                <div class="ui-g-12 ui-md-12 ui-lg-12">
                                    <p:commandButton actionListener="#{accountRecovery.checkAnswers}"
                                                     styleClass="ui-priority-primary"
                                                     style="width: auto; float: right; margin-bottom: 0px"
                                                     value="Enviar" process="loginform"
                                                     update="growl, loginform, @(.headerPanel)">
                                    </p:commandButton>
                                </div>

                            </div>

                        </div>

                    </p:fieldset>

                    <p:spacer rendered="#{accountRecovery.user != null and not accountRecovery.maxAttemptsReached() and not accountRecovery.passwordChanged }" />

                    <p:fieldset legend="Nueva contraseña" rendered="#{accountRecovery.correctAnswers and not accountRecovery.maxAttemptsReached() and not accountRecovery.passwordChanged }">

                        <div class="ui-fluid">

                            <div class="ui-g">

                                <div class="ui-g-12 ui-md-12 ui-lg-12">

                                    <h:panelGroup styleClass="md-inputfield">

                                        <p:password id="new-password" value="#{accountRecovery.newPassword1}" feedback="true"
                                                    promptLabel="Ingrese su nueva contraseña" weakLabel="Poco segura" goodLabel="Aceptable"
                                                    strongLabel="Segura" inline="true"
                                                    redisplay="true" autocomplete="off"
                                                    styleClass="#{accountRecovery.newPassword1Error}">
                                        </p:password>

                                        <label>Nueva Contraseña *</label>

                                    </h:panelGroup>

                                </div>

                                <div class="ui-g-12 ui-md-12 ui-lg-12">

                                    <h:panelGroup styleClass="md-inputfield">

                                        <p:password id="new-password2" value="#{accountRecovery.newPassword2}" feedback="true" inline="true"
                                                    promptLabel="Confirme su nueva contraseña" weakLabel="Poco segura" goodLabel="Aceptable" strongLabel="Segura"
                                                    redisplay="true" autocomplete="off"
                                                    styleClass="#{accountRecovery.newPassword2Error}">
                                        </p:password>

                                        <label>Confirmar Contraseña *</label>

                                    </h:panelGroup>

                                </div>

                                <div class="ui-g-12 ui-md-12 ui-lg-12">
                                    <p:commandButton actionListener="#{accountRecovery.changePassword}"
                                                     style="width: auto; float: right; margin-bottom: 0px"
                                                     value="Enviar" process="loginform"
                                                     update="growl, loginform, @(.headerPanel)">
                                    </p:commandButton>
                                </div>

                            </div>

                        </div>

                    </p:fieldset>

                    <div class="ui-fluid ui-g">

                        <div class="ui-g-12 ui-md-12 ui-lg-12" style="text-align: center">

                            <p:button outcome="/views/login.xhtml" value="Volver" styleClass="cyan-btn" style="width: auto; margin-bottom: 0px"
                                      icon="fa fa-arrow-left"
                                      rendered="#{not accountRecovery.passwordChanged and not accountRecovery.maxAttemptsReached() }"/>

                            <p:outputPanel styleClass="headerPanel" rendered="#{accountRecovery.passwordChanged or accountRecovery.maxAttemptsReached()}">
                                <p:button value="Ir al Login" icon="fa a fa-sign-in" href="/views/login.xhtml" styleClass="cyan-btn" style="width: auto; margin-bottom: 0px"/>
                            </p:outputPanel>

                        </div>

                    </div>

                    <p:ajaxStatus style="width:32px;height:32px;position:fixed;right:7px;bottom:7px">
                        <f:facet name="start">
                            <p:graphicImage name="images/preloader.gif" library="rio-layout"/>
                        </f:facet>

                        <f:facet name="complete">
                            <h:outputText value=""/>
                        </f:facet>
                    </p:ajaxStatus>
                </div>

            </div>
        </h:form>

        <span class="footer-text-left">
            <span>
                <i class="fa fa-copyright" style="color: #5f666c" /><h:outputText value="2016" style="color: #5f666c" /><a href="" style="color: #5f666c">Ministerio de Salud</a>
            </span>
            <br/>
            <span style="color: #5f666c">Version: <h:outputText value="${bpversion['version']} ${bpversion['build.date']}" />
            </span>
        </span>

    </div>


    <h:outputStylesheet name="css/ripple.css" library="ultima-layout" />
    <h:outputStylesheet name="css/layout-#{guestPreferences.theme}.css" library="ultima-layout" />
</h:body>

</html>