package cl.minsal.semantikos.designer;

import cl.minsal.semantikos.concept.ConceptBean;
import cl.minsal.semantikos.model.ConceptSMTK;
import cl.minsal.semantikos.model.helpertables.HelperTableRow;
import cl.minsal.semantikos.model.relationships.*;
import cl.minsal.semantikos.modelweb.ConceptSMTKWeb;
import cl.minsal.semantikos.modelweb.RelationshipDefinitionWeb;
import cl.minsal.semantikos.modelweb.RelationshipWeb;

import javax.annotation.PostConstruct;
import javax.faces.bean.ManagedBean;
import javax.faces.bean.ManagedProperty;
import javax.faces.bean.ViewScoped;
import java.util.Collections;
import java.util.List;

/**
 * Created by des01c7 on 14-10-16.
 */

public class AutogenerateBean {

    public static void load(ConceptSMTKWeb concept, List<RelationshipDefinitionWeb> relationshipDefinitions) {
        String autogeneratedTerm = "";
        // Se asume que las definiciones est√°n ordenadas de acuerdo a negocio
        for (RelationshipDefinition relationshipDefinition : relationshipDefinitions) {
            if(relationshipDefinition.isAutogenerable()) {
                List<RelationshipWeb> autogenerableRelationships = concept.getValidRelationshipsWebByRelationDefinition(relationshipDefinition);
                Collections.sort(autogenerableRelationships);
                for (Relationship relationship : autogenerableRelationships) {
                    autogeneratedTerm = autogeneratedTerm + " + " + autogenerate(relationship);
                }
            }
        }
        if(!autogeneratedTerm.isEmpty()) {
            autogeneratedTerm = autogeneratedTerm.substring(3);
        }
        concept.getValidDescriptionFavorite().setTerm(autogeneratedTerm);
        concept.getValidDescriptionFSN().setTerm(autogeneratedTerm);
    }

    public static String autogenerate(Relationship relationship) {

        String autogeneratedTerm = "";

        if(relationship.getRelationshipDefinition().getTargetDefinition().isSMTKType()) {
            ConceptSMTK concept = (ConceptSMTK) relationship.getTarget();
            autogeneratedTerm = concept.getDescriptionFavorite().getTerm();

            for (RelationshipAttribute relationshipAttribute : relationship.getRelationshipAttributes()) {
                if(relationshipAttribute.getRelationAttributeDefinition().isOrderAttribute() ||
                        relationshipAttribute.getRelationAttributeDefinition().isAutogenerateAttribute()) {
                    continue;
                }
                autogeneratedTerm = autogeneratedTerm + relationshipAttribute.getTarget().toString() + " ";
            }
        }

        if(relationship.getRelationshipDefinition().getTargetDefinition().isHelperTable()) {
            HelperTableRow helperTableRow = (HelperTableRow) relationship.getTarget();
            autogeneratedTerm = helperTableRow.getDescription();
        }

        return autogeneratedTerm;

    }

}
